{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advocate Dashboard - NinexLegal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>body{background:linear-gradient(to bottom right,#1e3a8a,#3b82f6);min-height:100vh}</style>
</head>
<body>
<div class="container mx-auto px-4 py-6 max-w-7xl">
<div class="bg-white rounded-xl shadow-lg p-6 mb-6"><div class="flex items-center justify-between"><div class="flex items-center gap-4"><img src="{% static 'images/logo.png' %}" alt="NinexLegal" class="h-16 w-16 rounded-xl shadow-lg object-cover"><div><h1 class="text-3xl font-bold text-gray-800">Welcome, {{ employee_name }}</h1><p class="text-gray-600 mt-1">{{ employee.get_employee_type_display }}  ID: {{ employee_id }}</p></div></div><div class="text-right"><div class="text-sm text-gray-500" id="currentDate"></div><div class="flex gap-2 mt-2"><a href="{% url 'view_cases' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm inline-flex items-center"><i class="fas fa-th-list mr-2"></i>View All Cases</a><form method="post" action="{% url 'logout' %}" class="inline">{% csrf_token %}<button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm"><i class="fas fa-sign-out-alt mr-1"></i> Logout</button></form></div></div></div></div>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"><a href="{% url 'advocate_cases_filtered' 'all' %}" class="bg-white hover:bg-blue-50 rounded-lg shadow p-4 transition"><div class="text-2xl font-bold text-blue-600">{{ total_cases|default:0 }}</div><div class="text-sm text-gray-600">Total Cases</div></a><a href="{% url 'advocate_cases_filtered' 'completed' %}" class="bg-white hover:bg-green-50 rounded-lg shadow p-4 transition"><div class="text-2xl font-bold text-green-600">{{ completed_cases|default:0 }}</div><div class="text-sm text-gray-600">Completed</div></a><a href="{% url 'advocate_cases_filtered' 'pending' %}" class="bg-white hover:bg-yellow-50 rounded-lg shadow p-4 transition"><div class="text-2xl font-bold text-yellow-600">{{ pending_cases|default:0 }}</div><div class="text-sm text-gray-600">Pending</div></a><a href="{% url 'advocate_cases_filtered' 'hold_query_doc' %}" class="bg-white hover:bg-orange-50 rounded-lg shadow p-4 transition"><div class="text-2xl font-bold text-orange-600">{{ hold_query_doc_cases_list|length|default:0 }}</div><div class="text-sm text-gray-600">On Hold</div></a></div>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
<!-- Completed Cases Section with Expandable Categories -->
<div class="bg-white rounded-lg shadow-lg">
<div class="bg-blue-600 text-white p-4 rounded-t-lg">
<h2 class="font-bold text-lg">Completed Cases</h2>
<p class="text-xs text-blue-100 mt-1">Click to expand categories</p>
</div>
<div class="p-3 max-h-[500px] overflow-y-auto">
<!-- Positive Cases -->
<div class="mb-3">
<button onclick="toggleSection('positive')" class="w-full flex items-center justify-between p-3 bg-green-50 hover:bg-green-100 rounded border border-green-200 transition">
<div class="flex items-center space-x-2">
<i class="fas fa-check-circle text-green-600"></i>
<span class="font-semibold text-gray-800">Positive</span>
</div>
<div class="flex items-center space-x-2">
<span class="bg-green-600 text-white px-2 py-1 rounded-full text-xs font-bold">{{ positive_total }}</span>
<i class="fas fa-chevron-down text-green-600" id="positive-icon"></i>
</div>
</button>
<div id="positive-section" class="hidden mt-2 space-y-2 pl-4">
{% if positive_cases %}
{% for case in positive_cases %}
<div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
<div class="font-semibold text-gray-800">{{ case.case_number }}
{% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
</div>
<div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
<div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
<div class="mt-2 flex gap-2">
<a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
</div>
</div>
{% endfor %}
{% for case in positive_child_cases %}
<div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
<div class="font-semibold text-gray-800">{{ case.case_number }}
{% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
</div>
<div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
<div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
<div class="mt-2 flex gap-2">
<a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
</div>
</div>
{% endfor %}
{% else %}
<p class="text-gray-500 text-center py-4 text-sm">No positive cases</p>
{% endif %}
</div>
</div>

<!-- Positive Subject to Search Cases -->
<div class="mb-3">
<button onclick="toggleSection('positive_subject')" class="w-full flex items-center justify-between p-3 bg-teal-50 hover:bg-teal-100 rounded border border-teal-200 transition">
<div class="flex items-center space-x-2">
<i class="fas fa-search text-teal-600"></i>
<span class="font-semibold text-gray-800">Positive Subject to Search</span>
</div>
<div class="flex items-center space-x-2">
<span class="bg-teal-600 text-white px-2 py-1 rounded-full text-xs font-bold">{{ positive_subject_total }}</span>
<i class="fas fa-chevron-down text-teal-600" id="positive_subject-icon"></i>
</div>
</button>
<div id="positive_subject-section" class="hidden mt-2 space-y-2 pl-4">
{% if positive_subject_cases %}
{% for case in positive_subject_cases %}
<div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
<div class="font-semibold text-gray-800">{{ case.case_number }}
{% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
</div>
<div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
<div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
<div class="mt-2 flex gap-2">
<a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
</div>
</div>
{% endfor %}
{% for case in positive_subject_child_cases %}
<div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
<div class="font-semibold text-gray-800">{{ case.case_number }}
{% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
</div>
<div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
<div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
<div class="mt-2 flex gap-2">
<a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
</div>
</div>
{% endfor %}
{% else %}
<p class="text-gray-500 text-center py-4 text-sm">No cases</p>
{% endif %}
</div>
</div>

<!-- Negative Cases -->
<div class="mb-3">
<button onclick="toggleSection('negative')" class="w-full flex items-center justify-between p-3 bg-red-50 hover:bg-red-100 rounded border border-red-200 transition">
<div class="flex items-center space-x-2">
<i class="fas fa-times-circle text-red-600"></i>
<span class="font-semibold text-gray-800">Negative</span>
</div>
<div class="flex items-center space-x-2">
<span class="bg-red-600 text-white px-2 py-1 rounded-full text-xs font-bold">{{ negative_total }}</span>
<i class="fas fa-chevron-down text-red-600" id="negative-icon"></i>
</div>
</button>
<div id="negative-section" class="hidden mt-2 space-y-2 pl-4">
{% if negative_cases %}
{% for case in negative_cases %}
<div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
<div class="font-semibold text-gray-800">{{ case.case_number }}
{% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
</div>
<div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
<div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
<div class="mt-2 flex gap-2">
<a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
</div>
</div>
{% endfor %}
{% for case in negative_child_cases %}
<div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
<div class="font-semibold text-gray-800">{{ case.case_number }}
{% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
</div>
<div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
<div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
<div class="mt-2 flex gap-2">
<a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
</div>
</div>
{% endfor %}
{% else %}
<p class="text-gray-500 text-center py-4 text-sm">No negative cases</p>
{% endif %}
</div>
</div>

<!-- SRO Document Pending Cases -->
<div class="mb-3">
<button onclick="toggleSection('sro_doc_pending')" class="w-full flex items-center justify-between p-3 bg-orange-50 hover:bg-orange-100 rounded border border-orange-200 transition">
<div class="flex items-center space-x-2">
<i class="fas fa-file-upload text-orange-600"></i>
<span class="font-semibold text-gray-800">SRO Document Pending</span>
</div>
<div class="flex items-center space-x-2">
<span class="bg-orange-600 text-white px-2 py-1 rounded-full text-xs font-bold">{{ sro_document_pending_total }}</span>
<i class="fas fa-chevron-down text-orange-600" id="sro_doc_pending-icon"></i>
</div>
</button>
<div id="sro_doc_pending-section" class="hidden mt-2 space-y-2 pl-4">
{% if sro_document_pending_cases or sro_document_pending_child_cases %}
  {% for case in sro_document_pending_cases %}
  <div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
    <div class="font-semibold text-gray-800">{{ case.case_number }}
    {% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
    </div>
    <div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
    <div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
    <div class="text-xs text-orange-600 mt-1"><i class="fas fa-info-circle mr-1"></i>Upload final document after SRO receipt</div>
    <div class="mt-2 flex gap-2">
      <a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
      <a href="{% url 'case_finalize_with_document' case.id %}" class="text-orange-600 hover:underline text-xs">Upload Final Doc</a>
    </div>
  </div>
  {% endfor %}

  {% for case in sro_document_pending_child_cases %}
  <div class="p-3 bg-gray-50 hover:bg-gray-100 rounded border text-sm">
    <div class="font-semibold text-gray-800">{{ case.case_number }}
    {% if case.parent_case %}<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold bg-green-500 text-white">Child</span>{% endif %}
    </div>
    <div class="text-xs text-gray-600">{{ case.applicant_name }}</div>
    <div class="text-xs text-gray-500">LRN: {{ case.legal_reference_number|default:'--' }}</div>
    <div class="text-xs text-orange-600 mt-1"><i class="fas fa-info-circle mr-1"></i>Upload final document after SRO receipt</div>
    <div class="mt-2 flex gap-2">
      <a href="{% url 'case_detail' case.id %}" class="text-blue-600 hover:underline text-xs">Detail</a>
      <a href="{% url 'case_finalize_with_document' case.id %}" class="text-orange-600 hover:underline text-xs">Upload Final Doc</a>
    </div>
  </div>
  {% endfor %}
{% else %}
  <p class="text-gray-500 text-center py-4 text-sm">No SRO document pending cases</p>
{% endif %}
</div>
</div>
</div>
</div>

<!-- Due Today Column -->
<div class="bg-white rounded-lg shadow-lg"><div class="bg-yellow-500 text-white p-4 rounded-t-lg"><div class="flex items-center justify-between"><h2 class="font-bold text-lg">Due Today</h2><span class="bg-white text-yellow-600 px-3 py-1 rounded-full text-sm font-bold">{{ pending_today_list|length|default:0 }}</span></div></div><div class="p-3 max-h-[500px] overflow-y-auto">{% if pending_today_list %}{% for case in pending_today_list %}<div class="mb-2 p-3 bg-gray-50 hover:bg-gray-100 rounded border">{% include 'accounts/partials/advocate_case_row.html' %}</div>{% endfor %}{% else %}<p class="text-gray-500 text-center py-8 text-sm">No cases</p>{% endif %}</div></div>

<!-- All Pending Column -->
<div class="bg-white rounded-lg shadow-lg"><div class="bg-purple-600 text-white p-4 rounded-t-lg"><div class="flex items-center justify-between"><h2 class="font-bold text-lg">All Pending</h2><span class="bg-white text-purple-600 px-3 py-1 rounded-full text-sm font-bold">{{ pending_overall_list|length|default:0 }}</span></div></div><div class="p-3 max-h-[500px] overflow-y-auto">{% if pending_overall_list %}{% for case in pending_overall_list %}<div class="mb-2 p-3 bg-gray-50 hover:bg-gray-100 rounded border">{% include 'accounts/partials/advocate_case_row.html' %}</div>{% endfor %}{% else %}<p class="text-gray-500 text-center py-8 text-sm">No cases</p>{% endif %}</div></div></div>
</div>
<script>
document.getElementById('currentDate').textContent=new Date().toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});

function toggleSection(sectionId) {
  const section = document.getElementById(sectionId + '-section');
  const icon = document.getElementById(sectionId + '-icon');
  
  if (section.classList.contains('hidden')) {
    section.classList.remove('hidden');
    icon.classList.remove('fa-chevron-down');
    icon.classList.add('fa-chevron-up');
  } else {
    section.classList.add('hidden');
    icon.classList.remove('fa-chevron-up');
    icon.classList.add('fa-chevron-down');
  }
}
</script>
</body>
</html>
