{% extends 'cases/base.html' %}
{% block content %}
<div class="max-w-6xl mx-auto p-4">
  <h1 class="text-2xl font-semibold mb-4">SRO Dashboard</h1>
  <form method="get" class="mb-4">
    <input type="text" name="search" value="{{ search_query }}" placeholder="Search by applicant, case no, or LRN" class="w-full border rounded p-2" />
  </form>

  <div class="space-y-4">
    {% for c in cases %}
      <div class="bg-white rounded shadow p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="font-semibold">{{ c.case_number }} • {{ c.applicant_name }}</div>
            <div class="text-sm text-gray-600">{{ c.bank.name }} • {{ c.case_type.name }} • Status: {{ c.get_status_display }}</div>
            <div class="text-sm text-gray-600">LRN: {{ c.legal_reference_number|default:'-' }}</div>
          </div>
          <div class="flex items-center gap-2">
            <a class="px-3 py-2 bg-blue-600 text-white rounded" href="{% url 'sro_update_case' c.id %}">Update Parent</a>
            {% if c.child_cases.exists %}
              <a class="px-3 py-2 bg-amber-600 text-white rounded" href="{% url 'sro_update_group' c.id %}">Update Parent + Children</a>
            {% endif %}
          </div>
        </div>
        {% if c.child_cases.exists %}
          <div class="mt-3 border-t pt-3">
            <div class="text-sm font-medium mb-2">Child Cases ({{ c.child_cases.count }})</div>
            <ul class="grid grid-cols-1 md:grid-cols-2 gap-2">
              {% for ch in c.child_cases.all %}
                <li class="text-sm text-gray-700">• {{ ch.case_number }} — {{ ch.applicant_name }} ({{ ch.get_status_display }})</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
    {% empty %}
      <div class="bg-white rounded shadow p-4 text-gray-600">No cases forwarded to SRO found.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
